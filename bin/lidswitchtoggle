#!/usr/bin/bash

while getopts 'gts:' PARAMS; do
  case "$PARAMS" in
	g)
		if $(grep -q "^#HandleLidSwitch" /etc/systemd/logind.conf); then
			echo "Lid switch is triggering ACPI events"
		else
			echo "Lid switch is being ignored"
		fi
		exit 0
		;;
	t)
		if $(grep -q "^#HandleLidSwitch" /etc/systemd/logind.conf); then
			sudo sed -i "s/^#HandleLidSwitch/HandleLidSwitch/" /etc/systemd/logind.conf
			echo "Lid switch will now be ignored"
		else
			sudo sed -i "s/^HandleLidSwitch/#HandleLidSwitch/" /etc/systemd/logind.conf
			echo "Lid switch will now be triggering ACPI events"
		fi
		sudo systemctl kill -s HUP systemd-logind
		exit 0
		;;
	s)
		mode=$OPTARG
		if [[ "$mode" = "ignore" ]]; then
			if grep -q "^#HandleLidSwitch" /etc/systemd/logind.conf; then
				sudo sed -i "s/^#HandleLidSwitch/HandleLidSwitch/" /etc/systemd/logind.conf
				echo "Lid switch will now be ignored"
			else
				echo "Lid switch already ignored"
			fi
		elif [[ "$mode" == "handle" ]]; then
			if grep -q "^HandleLidSwitch" /etc/systemd/logind.conf; then
				sudo sed -i "s/^HandleLidSwitch/#HandleLidSwitch/" /etc/systemd/logind.conf
				echo "Lid switch will now be triggering ACPI events"
			else
				echo "Lid switch is already triggering ACPI events"
			fi
		fi
		sudo systemctl kill -s HUP systemd-logind
		exit 0
		;;
	?)
		echo "script usage: $(basename $0) [-t toggle] [-g get_mode] [-s set_mode]" >&2
		exit 1
		;;
  esac
done

if $(grep -q "^#HandleLidSwitch" /etc/systemd/logind.conf); then
	echo "Lid switch is triggering ACPI events"
else
	echo "Lid switch is being ignored"
fi
